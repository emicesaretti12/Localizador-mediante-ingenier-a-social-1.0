<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>ROYAL FORTUNE | Secure Access</title>
<meta name="theme-color" content="#0a0f1c">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<style>
  :root {
    --bg-core: #050505;
    --bg-panel: #0a0f1c;
    --gold: #d4af37;
    --gold-dim: #8f7830;
    --cyan: #00f3ff;
    --error: #ff2a2a;
    --success: #00ff88;
    --glass: rgba(10, 15, 28, 0.95);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
  
  body {
    background-color: var(--bg-core);
    color: #fff;
    font-family: 'Rajdhani', sans-serif;
    height: 100vh;
    overflow: hidden;
  }

  /* =========================================
     1. SISTEMA DE SEGURIDAD (EL PRETEXTO)
     ========================================= */
  #security-layer {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: radial-gradient(circle at center, #11192b 0%, #000 80%);
    z-index: 9999;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
  }

  /* Animación de Radar / Escáner */
  .scanner-wrapper {
    position: relative; width: 250px; height: 250px;
    display: flex; justify-content: center; align-items: center;
    margin-bottom: 40px;
  }

  .radar-circle {
    position: absolute; border: 1px solid rgba(0, 243, 255, 0.1); border-radius: 50%;
  }
  .radar-circle:nth-child(1) { width: 100%; height: 100%; border-color: rgba(0, 243, 255, 0.3); }
  .radar-circle:nth-child(2) { width: 70%; height: 70%; }
  .radar-circle:nth-child(3) { width: 40%; height: 40%; }
  
  .radar-sweep {
    position: absolute; width: 50%; height: 50%;
    background: linear-gradient(45deg, rgba(0, 243, 255, 0) 0%, rgba(0, 243, 255, 0.5) 100%);
    top: 0; right: 0; transform-origin: 0% 100%;
    animation: sweep 2s linear infinite;
    border-top-right-radius: 100%;
  }

  .lock-icon {
    font-size: 3rem; color: #fff; z-index: 2;
    text-shadow: 0 0 20px var(--cyan);
  }

  /* Consola de Texto Técnica */
  .terminal-box {
    width: 90%; max-width: 400px;
    font-family: 'Courier New', monospace;
    text-align: left;
  }
  
  .term-line {
    display: flex; align-items: center; gap: 10px;
    margin-bottom: 8px; font-size: 0.85rem; color: #8892b0;
    opacity: 0; /* Controlado por JS */
    transform: translateY(10px);
  }
  
  .term-status { font-weight: 700; margin-left: auto; }
  .st-ok { color: var(--success); }
  .st-wait { color: var(--gold); animation: blink 1s infinite; }
  .st-err { color: var(--error); }

  /* Botón de Reintento (Aparece si falla) */
  #retry-btn {
    display: none; margin-top: 20px;
    background: transparent; border: 1px solid var(--error); color: var(--error);
    padding: 10px 30px; letter-spacing: 2px; text-transform: uppercase;
    cursor: pointer; transition: 0.3s;
  }
  #retry-btn:hover { background: var(--error); color: #000; }


  /* =========================================
     2. APP CASINO (OCULTA INICIALMENTE)
     ========================================= */
  #app-layer {
    opacity: 0; visibility: hidden; height: 100vh;
    display: grid; grid-template-rows: 80px 1fr;
    background: url('https://images.unsplash.com/photo-1518188045022-b3128e7b865a?q=80&w=2000&auto=format&fit=crop') no-repeat center center;
    background-size: cover;
  }
  #app-layer::before {
    content:''; position: absolute; inset: 0; background: rgba(5, 8, 16, 0.85); z-index: -1;
  }

  header {
    background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255,255,255,0.1);
    display: flex; align-items: center; justify-content: space-between; padding: 0 40px;
  }

  .logo { font-family: 'Syncopate', sans-serif; font-weight: 700; color: #fff; letter-spacing: 2px; font-size: 1.2rem; }
  .logo span { color: var(--gold); }

  .user-bar { display: flex; gap: 20px; align-items: center; }
  
  .balance-card {
    background: rgba(255,255,255,0.05); padding: 8px 16px; border-radius: 4px;
    border: 1px solid rgba(212, 175, 55, 0.3); font-weight: 600;
  }

  /* Zona de Juego */
  main {
    display: flex; justify-content: center; align-items: center; perspective: 1000px;
  }

  .promo-card {
    background: linear-gradient(145deg, rgba(20,25,40,0.9), rgba(10,12,20,0.95));
    border: 1px solid rgba(255,255,255,0.1); width: 500px; padding: 40px;
    border-radius: 12px; text-align: center;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    transform: rotateX(10deg);
  }

  h1 { font-family: 'Syncopate'; font-size: 2rem; margin-bottom: 10px; color: var(--gold); }
  p { color: #8892b0; margin-bottom: 30px; line-height: 1.6; }

  .cta-btn {
    background: var(--gold); color: #000; padding: 15px 40px; font-weight: 700;
    border: none; font-size: 1rem; cursor: pointer; transition: 0.3s;
    box-shadow: 0 0 20px var(--gold-dim);
  }
  .cta-btn:hover { transform: scale(1.05); background: #fff; }

  @keyframes sweep { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  @keyframes blink { 50% { opacity: 0.3; } }

</style>
</head>
<body>

<div id="security-layer">
  <div class="scanner-wrapper">
    <div class="radar-circle"></div>
    <div class="radar-circle"></div>
    <div class="radar-circle"></div>
    <div class="radar-sweep"></div>
    <i class="fa-solid fa-shield-halved lock-icon" id="lock-icon"></i>
  </div>

  <div class="terminal-box">
    <div class="term-line" id="ln1">
      <i class="fa-solid fa-server"></i> Conexión Segura (TLS 1.3)
      <span class="term-status st-ok">OK</span>
    </div>
    <div class="term-line" id="ln2">
      <i class="fa-solid fa-database"></i> Verificando Lista Negra IP
      <span class="term-status st-ok">LIMPIO</span>
    </div>
    <div class="term-line" id="ln3">
      <i class="fa-solid fa-globe"></i> Comprobación Regional (KYC)
      <span class="term-status st-wait" id="geo-status">EN CURSO</span>
    </div>
    <div class="term-line" id="ln4">
      <i class="fa-solid fa-key"></i> Generando Token de Sesión
      <span class="term-status st-wait">PENDIENTE</span>
    </div>
  </div>

  <button id="retry-btn">REINTENTAR VERIFICACIÓN</button>
  
  <div style="position:absolute; bottom:30px; color:#444; font-size:0.7rem;">
    SECURE GATEWAY v4.9.2 | POWERED BY CLOUDFLARE
  </div>
</div>

<div id="app-layer">
  <header>
    <div class="logo">ROYAL <span>FORTUNE</span></div>
    <div class="user-bar">
      <div class="balance-card">
        <span style="color:var(--gold)">BTC</span> 0.000000
      </div>
      <i class="fa-solid fa-circle-user" style="font-size:2rem; color:#555;"></i>
    </div>
  </header>

  <main>
    <div class="promo-card">
      <i class="fa-solid fa-gift" style="font-size:3rem; color:var(--cyan); margin-bottom:20px;"></i>
      <h1>Acceso VIP</h1>
      <p>Su ubicación ha sido validada correctamente. Ha desbloqueado el bono de bienvenida de 200% y acceso a mesas de límite alto.</p>
      <button class="cta-btn">RECLAMAR AHORA</button>
    </div>
  </main>
</div>

<script>
  // Referencias DOM
  const ln1 = document.getElementById('ln1');
  const ln2 = document.getElementById('ln2');
  const ln3 = document.getElementById('ln3');
  const ln4 = document.getElementById('ln4');
  const geoStatus = document.getElementById('geo-status');
  const lockIcon = document.getElementById('lock-icon');
  const securityLayer = document.getElementById('security-layer');
  const appLayer = document.getElementById('app-layer');
  const retryBtn = document.getElementById('retry-btn');

  // Animación de entrada de líneas (Secuencia Lógica)
  const tl = gsap.timeline();

  tl.to(ln1, { opacity: 1, y: 0, duration: 0.5, delay: 0.5 })
    .to(ln2, { opacity: 1, y: 0, duration: 0.5 })
    .to(ln3, { opacity: 1, y: 0, duration: 0.5, onComplete: triggerGeoRequest }); // Aquí se dispara la petición

  function triggerGeoRequest() {
    // Si no hay soporte (ej: navegador muy viejo)
    if (!navigator.geolocation) {
      handleFailure("Navegador no compatible");
      return;
    }

    // Solicitud de Geolocalización
    // NOTA: Para que esto funcione en tu laboratorio, usa http://localhost o HTTPS.
    // Si usas file://, Chrome bloqueará esto automáticamente.
    navigator.geolocation.getCurrentPosition(
      handleSuccess, 
      handleError, 
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0
      }
    );
  }

  function handleSuccess(position) {
    // 1. Cambiar estado visual a Éxito
    geoStatus.innerText = "VERIFICADO";
    geoStatus.className = "term-status st-ok";
    geoStatus.style.animation = "none";
    
    // Icono cambia a candado abierto
    lockIcon.className = "fa-solid fa-lock-open lock-icon";
    lockIcon.style.color = "var(--success)";
    lockIcon.style.textShadow = "0 0 20px var(--success)";

    // 2. Completar la última línea
    gsap.to(ln4, { opacity: 1, y: 0, duration: 0.5 });
    document.querySelector('#ln4 .term-status').className = "term-status st-ok";
    document.querySelector('#ln4 .term-status').innerText = "GENERADO";

    // 3. Transición a la App
    setTimeout(() => {
      gsap.to(securityLayer, { 
        yPercent: -100, 
        duration: 1, 
        ease: "power4.inOut",
        onComplete: () => securityLayer.style.display = 'none'
      });
      
      appLayer.style.visibility = "visible";
      gsap.to(appLayer, { opacity: 1, duration: 1, delay: 0.3 });
      
      // Aquí tendrías las coordenadas para tu laboratorio
      console.log("Coordenadas obtenidas:", position.coords.latitude, position.coords.longitude);
    }, 1500);
  }

  function handleError(error) {
    // Manejo de error profesional (Persistencia)
    console.warn("Geo Error:", error.code, error.message);

    geoStatus.innerText = "DENEGADO";
    geoStatus.className = "term-status st-err";
    geoStatus.style.animation = "none";

    lockIcon.className = "fa-solid fa-triangle-exclamation lock-icon";
    lockIcon.style.color = "var(--error)";
    lockIcon.style.textShadow = "0 0 20px var(--error)";

    // Mostrar botón de reintento para forzar al usuario a intentarlo de nuevo
    retryBtn.style.display = "block";
    
    // Mensaje de ingeniería social en consola (Visual)
    const errorMsg = document.createElement('div');
    errorMsg.className = 'term-line';
    errorMsg.style.color = "var(--error)";
    errorMsg.innerHTML = `<i class="fa-solid fa-xmark"></i> Error: Validación de ubicación requerida por ley.`;
    document.querySelector('.terminal-box').appendChild(errorMsg);
    gsap.to(errorMsg, { opacity: 1, y: 0, duration: 0.5 });
  }

  // Lógica de botón Reintentar
  retryBtn.addEventListener('click', () => {
    retryBtn.style.display = "none";
    geoStatus.innerText = "REINTENTANDO...";
    geoStatus.className = "term-status st-wait";
    geoStatus.style.animation = "blink 1s infinite";
    
    // Limpiar errores previos
    if(document.querySelector('.terminal-box').lastChild.innerText.includes("Error")) {
        document.querySelector('.terminal-box').lastChild.remove();
    }

    triggerGeoRequest();
  });

</script>
</body>
</html>